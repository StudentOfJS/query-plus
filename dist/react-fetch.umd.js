(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("react"),require("idb-keyval")):typeof define=="function"&&define.amd?define(["exports","react","idb-keyval"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n["react-fetch"]={},n.React,n.idbKeyval))})(this,function(n,t,o){"use strict";var N=Object.defineProperty,I=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var w=(n,t,o)=>t in n?N(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,l=(n,t)=>{for(var o in t||(t={}))J.call(t,o)&&w(n,o,t[o]);if(Z)for(var o of Z(t))U.call(t,o)&&w(n,o,t[o]);return n},s=(n,t)=>I(n,S(t));const f="dmFyIHU9T2JqZWN0LmRlZmluZVByb3BlcnR5LGg9T2JqZWN0LmRlZmluZVByb3BlcnRpZXM7dmFyIGc9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7dmFyIG49T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczt2YXIgZD1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LHc9T2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTt2YXIgbD0ocyx0LGUpPT50IGluIHM/dShzLHQse2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOmV9KTpzW3RdPWUsYz0ocyx0KT0+e2Zvcih2YXIgZSBpbiB0fHwodD17fSkpZC5jYWxsKHQsZSkmJmwocyxlLHRbZV0pO2lmKG4pZm9yKHZhciBlIG9mIG4odCkpdy5jYWxsKHQsZSkmJmwocyxlLHRbZV0pO3JldHVybiBzfSxpPShzLHQpPT5oKHMsZyh0KSk7KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIscz0+e2NvbnN0e3R5cGU6dH09cy5kYXRhO2xldCBlPW5ldyBBYm9ydENvbnRyb2xsZXIsYT1lLnNpZ25hbDtpZih0PT09ImNhbmNlbCImJmUuc2lnbmFsLmFib3J0KCksdD09PSJmZXRjaCIpe2NvbnN0e3VybDpmLG9wdGlvbnM6b309cy5kYXRhO2ZldGNoKGYsbz9pKGMoe30sbykse3NpZ25hbDphfSk6e3NpZ25hbDphfSkudGhlbihyPT57aWYoIXIub2t8fHIuc3RhdHVzPT09NDA0KXRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgU3RhdHVzOiAke3Iuc3RhdHVzfWApO2lmKHIuc3RhdHVzPT09NDAzKXRocm93IG5ldyBFcnJvcigiVW5hdXRob3JpemVkISIpO3JldHVybiByLmpzb24oKX0pLnRoZW4ocj0+e3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6InN1Y2Nlc3MiLGRhdGE6cn0pLGU9dm9pZCAwfSkuY2F0Y2gocj0+e3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6ci5tZXNzYWdlfHwiVW5rbm93biBlcnJvciJ9KX0pfX0pfSkoKTsK",y=typeof window!="undefined"&&window.Blob&&new Blob([atob(f)],{type:"text/javascript;charset=utf-8"});function g(){const e=y&&(window.URL||window.webkitURL).createObjectURL(y);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+f,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}const G=24*60*60*1e3;function u(e){e==null||e.postMessage({type:"cancel"}),e==null||e.terminate(),e=void 0}function H(e,d){switch(d.type){case"nuke":return s(l({},e),{nuked:!0});case"data":return s(l({},e),{data:d.data,loading:!1,nuked:!1,error:void 0});case"clearError":return s(l({},e),{error:void 0});case"error":return s(l({},e),{error:d.error,loading:!1});case"loading":return s(l({},e),{loading:d.loading});default:return e}}const W={data:void 0,error:void 0,loading:!1,nuked:!1,update:!0};function B(){const[e,d]=t.useReducer(H,W),a=t.useRef({worker:void 0,controller:new AbortController});let{worker:i,controller:m}=a.current;return t.useEffect(()=>{var r,p,b;return!window&&!((b=(p=(r=a==null?void 0:a.current)==null?void 0:r.controller)==null?void 0:p.signal)!=null&&b.aborted)&&(d({type:"loading",loading:!1}),d({type:"error",error:new Error("window is not defined")}),u(i)),()=>{u(i)}},[window,a.current.controller]),l({fetchWorker:async({url:r,fetchOptions:p,cache:b=!1,maxAge:L=G})=>{u(i);let Y=b?await o.get(r.toString()).then(c=>c!=null&&c.timestamp?(c==null?void 0:c.timestamp)+L<=Date.now()?(o.del(r.toString()),!0):(console.log("cache hit",r.toString()),d({type:"data",data:c==null?void 0:c.data}),!1):!0):!0;window&&Y&&(o.del(r.toString()),i=new g,d({type:"loading",loading:!0}),i.postMessage({type:"fetch",url:r,fetchOptions:p}),i.addEventListener("message",({data:{data:c,type:h}})=>{var R;if(!((R=m==null?void 0:m.signal)!=null&&R.aborted))switch(h){case"success":if(b){let k={timestamp:Date.now(),data:c};o.set(r.toString(),k).then(()=>{console.log("saved data")}).catch(()=>{console.error("couldn't access indexDB to save data")})}d({type:"data",data:c,url:r,fetchOptions:p});break;default:d({type:"error",error:new Error(h)});break}u(i)}))},nukeDB:()=>o.clear()},e)}n.useFetchHook=B,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
