(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("react"),require("idb-keyval")):typeof define=="function"&&define.amd?define(["exports","react","idb-keyval"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n["react-fetch"]={},n.React,n.idbKeyval))})(this,function(n,t,d){"use strict";var H=Object.defineProperty,U=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var g=(n,t,d)=>t in n?H(n,t,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[t]=d,i=(n,t)=>{for(var d in t||(t={}))k.call(t,d)&&g(n,d,t[d]);if(S)for(var d of S(t))w.call(t,d)&&g(n,d,t[d]);return n},X=(n,t)=>U(n,V(t));const Y="dmFyIE09T2JqZWN0LmRlZmluZVByb3BlcnR5LFQ9T2JqZWN0LmRlZmluZVByb3BlcnRpZXM7dmFyIG09T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7dmFyIGc9T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczt2YXIgUz1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LFU9T2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTt2YXIgcD0oZixuLGkpPT5uIGluIGY/TShmLG4se2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOml9KTpmW25dPWksZD0oZixuKT0+e2Zvcih2YXIgaSBpbiBufHwobj17fSkpUy5jYWxsKG4saSkmJnAoZixpLG5baV0pO2lmKGcpZm9yKHZhciBpIG9mIGcobikpVS5jYWxsKG4saSkmJnAoZixpLG5baV0pO3JldHVybiBmfSx3PShmLG4pPT5UKGYsbShuKSk7KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IGY9dD0+dHlwZW9mIHQ9PSJvYmplY3QiJiYhQXJyYXkuaXNBcnJheSh0KSYmdCE9PW51bGwsbj0odCxlLHM9e30pPT4oT2JqZWN0LmtleXModCkuZm9yRWFjaChyPT57bGV0IGw9ZT9lKyIuIityOnI7Zih0W3JdKT9uKHRbcl0sbCxzKTpzW2xdPUFycmF5LmlzQXJyYXkodFtyXSk/dFtyXS5zb3J0KCk6dFtyXX0pLE9iamVjdC5lbnRyaWVzKHMpLnNvcnQoKSksaT10PT50LmZsYXRNYXAoZT0+ZihlKT9uKGUpOltlXSkuc29ydCgpLE89dD0+e3ZhciBlLHM7cmV0dXJuKHM9KGU9dD09bnVsbD92b2lkIDA6dC5tZXRob2QpPT1udWxsP3ZvaWQgMDplLnRvVXBwZXJDYXNlKCkpIT1udWxsP3M6IkdFVCJ9LEE9KHQsZSxzKT0+e2xldCByPUFycmF5LmlzQXJyYXkodCk/ImFycmF5Ijp0eXBlb2YgdCxsPUFycmF5LmlzQXJyYXkoZSk/ImFycmF5Ijp0eXBlb2YgZTtyZXR1cm4gciE9PWw/ITE6ciE9PSJvYmplY3QiJiZyIT09ImFycmF5Ij9yPT09bDpzJiZyPT09Im9iamVjdCI/cy5tYXAoYz0+dFtjXT09PWVbY10pLmV2ZXJ5KGM9PmMpOihyPT09ImFycmF5IiYmKHQ9aSh0KSxlPWkoZSkpLCFzJiZyPT09Im9iamVjdCImJih0PW4odCksZT1uKGUpKSxKU09OLnN0cmluZ2lmeSh0KT09PUpTT04uc3RyaW5naWZ5KGUpKX0sRT0odCxlKT0+T2JqZWN0LmVudHJpZXModCkucmVkdWNlKChyLGwpPT57Y29uc3RbYyx5XT1sO2xldCBhPWVbY10sbz10W2NdO2lmKEEoeSxhKSlyZXR1cm4gcjtpZihmKGEpKXtsZXQgaD1PYmplY3Qua2V5cyhhKS5tYXAodT0+QShhW3VdLG9bdV0pP3ZvaWQgMDpbYCR7Y30uJHt1fWAsYVt1XV0pLmZpbHRlcih1PT51KTtyZXR1cm5bLi4uciwuLi5oXX1yZXR1cm4gcn0sW10pO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsdD0+e2NvbnN0e3R5cGU6ZX09dC5kYXRhO2xldCBzPW5ldyBBYm9ydENvbnRyb2xsZXIscj1zPT1udWxsP3ZvaWQgMDpzLnNpZ25hbDtpZihlPT09ImNhbmNlbCImJihzPT1udWxsfHxzLmFib3J0KCkpLGU9PT0iZmV0Y2giKXtjb25zdHt1cmw6bCxvcHRpb25zOmMsZXhpc3RpbmdEYXRhOnl9PXQuZGF0YTtmZXRjaChsLGM/dyhkKHt9LGMpLHtzaWduYWw6cn0pOntzaWduYWw6cn0pLnRoZW4oYT0+e2lmKCFhLm9rfHxhLnN0YXR1cz09PTQwNCl0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3IhIFN0YXR1czogJHthLnN0YXR1c31gKTtpZihhLnN0YXR1cz09PTQwMyl0aHJvdyBuZXcgRXJyb3IoIlVuYXV0aG9yaXplZCEiKTtyZXR1cm4gYS5qc29uKCl9KS50aGVuKGE9PntsZXQgbz1PKGMpO2lmKCF5KXNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6byxkYXRhOmF9KTtlbHNlIGlmKGYoYSkpe2xldCBoPUUoeSxhKTtzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOiJVUERBVEVTIixkYXRhOmh9KX1lbHNlIHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6byxkYXRhOmF9KX0pLmNhdGNoKGE9PntzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOmEubWVzc2FnZXx8IlVua25vd24gZXJyb3IifSl9KX19KX0pKCk7Cg==",T=typeof window!="undefined"&&window.Blob&&new Blob([atob(Y)],{type:"text/javascript;charset=utf-8"});function I(){const e=T&&(window.URL||window.webkitURL).createObjectURL(T);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+Y,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}const R="usestore-db",P="usestore-db",W=e=>{const{persistData:o,storeName:r}=i({persistData:!0,storeName:P},e),l=t.useRef();return t.useEffect(()=>(l.current=d.createStore(R,r),()=>{!o&&d.clear(l.current),l.current=void 0}),[]),{__dangerouslyNukeAllStores:()=>{indexedDB.deleteDatabase(R)},del:s=>d.del(s,l.current),get:s=>d.get(s,l.current),getMany:s=>d.getMany(s,l.current),set:(s,a)=>d.set(s,a,l.current),setMany:s=>d.setMany(s,l.current),update:(s,a)=>d.update(s,a,l.current)}};function J(e,o){switch(o.type){case"pre-load":return X(i({},e),{data:o.data});case"data":return X(i({},e),{data:o.data,loading:!1,error:void 0});case"error":return X(i({},e),{error:o.error,loading:!1});case"loading":return X(i({},e),{loading:o.loading});default:return e}}const N=24*60*60*1e3;function E(e){e==null||e.postMessage({type:"cancel"}),e==null||e.terminate(),e=void 0}const x=(e,o)=>o?e+o<Date.now():!0,L=e=>typeof e=="object"&&!Array.isArray(e)&&e!==null,B=e=>{var o,r;return(r=(o=e==null?void 0:e.method)==null?void 0:o.toUpperCase())!=null?r:"GET"};function z(){const{del:e,get:o,set:r,update:l}=W(),[s,a]=t.useReducer(J,C),y=t.useRef(),F=async({url:m,fetchOptions:K,maxAge:b=N})=>{let u=y.current;a({type:"loading",loading:!0});let f=B(K);f==="DELETE"&&e(m.toString()),f==="GET"&&o(m.toString()).then(c=>{if(!c)throw new Error("no value found in db");x(b,c==null?void 0:c.timestamp)?e(m.toString()):a({type:"pre-load",data:c==null?void 0:c.data})}).catch(c=>{console.error(c)}),u==null||u.addEventListener("message",({data:{type:c,data:p}})=>{if(c==="DELETE")a({type:"loading",loading:!1});else if(c!=="UPDATES")if(c==="GET"){a({type:"data",data:p});let h={timestamp:Date.now(),maxAge:b,data:p};r(m.toString(),h).then(()=>{console.log("saved data")}).catch(()=>{console.error("couldn't access indexedDB to save data")})}else c==="PUT"||c==="POST"?l(m.toString(),Z=>{let h=Date.now(),G=L(p)&&L(Z==null?void 0:Z.data)?i(i({},p),Z.data):p;return a({type:"data",data:G}),{timestamp:h,maxAge:b,data:G}}).then(()=>{console.log("updated data")}).catch(()=>{a({type:"loading",loading:!1}),console.error("save to indexedDB failed")}):a({type:"error",error:new Error(c)})}),u==null||u.postMessage({type:"fetch",url:m,fetchOptions:K})};return t.useEffect(()=>(y.current=new I,()=>{E(y.current)}),[]),i({fetchWorker:F},s)}const C={data:void 0,error:void 0,loading:!1,update:!0};n.useFetch=z,n.useStore=W,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
