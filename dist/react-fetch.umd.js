(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("react"),require("idb-keyval")):typeof define=="function"&&define.amd?define(["exports","react","idb-keyval"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n["react-fetch"]={},n.React,n.idbKeyval))})(this,function(n,t,o){"use strict";var k=Object.defineProperty,S=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var g=(n,t,o)=>t in n?k(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,l=(n,t)=>{for(var o in t||(t={}))U.call(t,o)&&g(n,o,t[o]);if(w)for(var o of w(t))z.call(t,o)&&g(n,o,t[o]);return n},a=(n,t)=>S(n,J(t));const y="dmFyIHU9T2JqZWN0LmRlZmluZVByb3BlcnR5LGg9T2JqZWN0LmRlZmluZVByb3BlcnRpZXM7dmFyIGc9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7dmFyIG49T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczt2YXIgZD1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LHc9T2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTt2YXIgbD0ocyx0LGUpPT50IGluIHM/dShzLHQse2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOmV9KTpzW3RdPWUsYz0ocyx0KT0+e2Zvcih2YXIgZSBpbiB0fHwodD17fSkpZC5jYWxsKHQsZSkmJmwocyxlLHRbZV0pO2lmKG4pZm9yKHZhciBlIG9mIG4odCkpdy5jYWxsKHQsZSkmJmwocyxlLHRbZV0pO3JldHVybiBzfSxpPShzLHQpPT5oKHMsZyh0KSk7KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIscz0+e2NvbnN0e3R5cGU6dH09cy5kYXRhO2xldCBlPW5ldyBBYm9ydENvbnRyb2xsZXIsYT1lLnNpZ25hbDtpZih0PT09ImNhbmNlbCImJmUuc2lnbmFsLmFib3J0KCksdD09PSJmZXRjaCIpe2NvbnN0e3VybDpmLG9wdGlvbnM6b309cy5kYXRhO2ZldGNoKGYsbz9pKGMoe30sbykse3NpZ25hbDphfSk6e3NpZ25hbDphfSkudGhlbihyPT57aWYoIXIub2t8fHIuc3RhdHVzPT09NDA0KXRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgU3RhdHVzOiAke3Iuc3RhdHVzfWApO2lmKHIuc3RhdHVzPT09NDAzKXRocm93IG5ldyBFcnJvcigiVW5hdXRob3JpemVkISIpO3JldHVybiByLmpzb24oKX0pLnRoZW4ocj0+e3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6InN1Y2Nlc3MiLGRhdGE6cn0pLGU9dm9pZCAwfSkuY2F0Y2gocj0+e3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6ci5tZXNzYWdlfHwiVW5rbm93biBlcnJvciJ9KX0pfX0pfSkoKTsK",R=typeof window!="undefined"&&window.Blob&&new Blob([atob(y)],{type:"text/javascript;charset=utf-8"});function G(){const e=R&&(window.URL||window.webkitURL).createObjectURL(R);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+y,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}const H=24*60*60*1e3;function m(e){e==null||e.postMessage({type:"cancel"}),e==null||e.terminate(),e=void 0}function L(e,d){switch(d.type){case"nuke":return a(l({},e),{nuked:!0});case"pre-load":return a(l({},e),{data:d.data});case"data":return a(l({},e),{data:d.data,loading:!1,nuked:!1,error:void 0});case"clearError":return a(l({},e),{error:void 0});case"error":return a(l({},e),{error:d.error,loading:!1});case"loading":return a(l({},e),{loading:d.loading});default:return e}}const W={data:void 0,error:void 0,loading:!1,nuked:!1,update:!0};function B(){const[e,d]=t.useReducer(L,W),p=t.useRef({worker:void 0,controller:new AbortController});let{worker:s,controller:u}=p.current;return t.useEffect(()=>{var c,i,b;return!window&&!((b=(i=(c=p==null?void 0:p.current)==null?void 0:c.controller)==null?void 0:i.signal)!=null&&b.aborted)&&(d({type:"loading",loading:!1}),d({type:"error",error:new Error("window is not defined")}),m(s)),()=>{m(s)}},[window,p.current.controller]),l({fetchWorker:async({url:c,fetchOptions:i,cache:b=!1,maxAge:Y=H})=>{m(s);let f=((i==null?void 0:i.method)||"GET").toLowerCase()==="get",I=f?await o.get(c.toString()).then(r=>r!=null&&r.timestamp?(r==null?void 0:r.timestamp)+Y<=Date.now()?(o.del(c.toString()),!0):(console.log("cache hit",c.toString()),d({type:b?"data":"pre-load",data:r==null?void 0:r.data}),!b):!0):!0;window&&I&&(f&&o.del(c.toString()),s=new G,d({type:"loading",loading:!0}),s.postMessage({type:"fetch",url:c,fetchOptions:i}),s.addEventListener("message",({data:{data:r,type:h}})=>{var Z;if(!((Z=u==null?void 0:u.signal)!=null&&Z.aborted))if(h==="success"){if(d({type:"data",data:r,url:c,fetchOptions:i}),b&&f){let N={timestamp:Date.now(),data:r};o.set(c.toString(),N).then(()=>{console.log("saved data")}).catch(()=>{console.error("couldn't access indexedDB to save data")})}}else d({type:"error",error:new Error(h)});m(s)}))},nukeDB:()=>{o.clear()}},e)}n.useFetchHook=B,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
