(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("react"),require("idb-keyval")):typeof define=="function"&&define.amd?define(["exports","react","idb-keyval"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n["react-fetch"]={},n.React,n.idbKeyval))})(this,function(n,t,d){"use strict";var P=Object.defineProperty,U=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var H=(n,t,d)=>t in n?P(n,t,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[t]=d,i=(n,t)=>{for(var d in t||(t={}))O.call(t,d)&&H(n,d,t[d]);if(S)for(var d of S(t))v.call(t,d)&&H(n,d,t[d]);return n},m=(n,t)=>U(n,M(t));const R="dmFyIGc9T2JqZWN0LmRlZmluZVByb3BlcnR5LGw9T2JqZWN0LmRlZmluZVByb3BlcnRpZXM7dmFyIHc9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7dmFyIGY9T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczt2YXIgbT1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LHk9T2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTt2YXIgZD0oYSx0LGUpPT50IGluIGE/ZyhhLHQse2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOmV9KTphW3RdPWUsbz0oYSx0KT0+e2Zvcih2YXIgZSBpbiB0fHwodD17fSkpbS5jYWxsKHQsZSkmJmQoYSxlLHRbZV0pO2lmKGYpZm9yKHZhciBlIG9mIGYodCkpeS5jYWxsKHQsZSkmJmQoYSxlLHRbZV0pO3JldHVybiBhfSx1PShhLHQpPT5sKGEsdyh0KSk7KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IGE9dD0+e3ZhciBlLHM7cmV0dXJuKHM9KGU9dD09bnVsbD92b2lkIDA6dC5tZXRob2QpPT1udWxsP3ZvaWQgMDplLnRvVXBwZXJDYXNlKCkpIT1udWxsP3M6IkdFVCJ9O3NlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsdD0+e2NvbnN0e3R5cGU6ZX09dC5kYXRhO2xldCBzPW5ldyBBYm9ydENvbnRyb2xsZXIsbj1zPT1udWxsP3ZvaWQgMDpzLnNpZ25hbDtpZihlPT09ImNhbmNlbCImJihzPT1udWxsfHxzLmFib3J0KCkpLGU9PT0iZmV0Y2giKXtjb25zdHt1cmw6YyxvcHRpb25zOmh9PXQuZGF0YTtmZXRjaChjLGg/dShvKHt9LGgpLHtzaWduYWw6bn0pOntzaWduYWw6bn0pLnRoZW4ocj0+e2lmKCFyLm9rfHxyLnN0YXR1cz09PTQwNCl0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3IhIFN0YXR1czogJHtyLnN0YXR1c31gKTtpZihyLnN0YXR1cz09PTQwMyl0aHJvdyBuZXcgRXJyb3IoIlVuYXV0aG9yaXplZCEiKTtyZXR1cm4gci5qc29uKCl9KS50aGVuKHI9PntsZXQgaT1hKGgpO3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6aSxkYXRhOnJ9KSxzPXZvaWQgMH0pLmNhdGNoKHI9PntzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOnIubWVzc2FnZXx8IlVua25vd24gZXJyb3IifSl9KX19KX0pKCk7Cg==",g=typeof window!="undefined"&&window.Blob&&new Blob([atob(R)],{type:"text/javascript;charset=utf-8"});function B(){const e=g&&(window.URL||window.webkitURL).createObjectURL(g);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+R,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}const G="usestore-db",N="usestore-db",X=e=>{const{persistData:r,storeName:Z}=i({persistData:!0,storeName:N},e),o=t.useRef();return t.useEffect(()=>(o.current=d.createStore(G,Z),()=>{!r&&d.clear(o.current),o.current=void 0}),[]),{del:s=>d.del(s,o.current),get:s=>d.get(s,o.current),getMany:s=>d.getMany(s,o.current),set:(s,a)=>d.set(s,a,o.current),setMany:s=>d.setMany(s,o.current),update:(s,a)=>d.update(s,a,o.current)}};function I(e,r){switch(r.type){case"pre-load":return m(i({},e),{data:r.data});case"data":return m(i({},e),{data:r.data,loading:!1,error:void 0});case"error":return m(i({},e),{error:r.error,loading:!1});case"loading":return m(i({},e),{loading:r.loading});default:return e}}const E=24*60*60*1e3,Y=e=>typeof e=="object"&&!Array.isArray(e)&&e!==null;function J(e){e==null||e.postMessage({type:"cancel"}),e==null||e.terminate(),e=void 0}const w=(e,r=0)=>r+e>Date.now(),x=e=>{var r;return((r=e==null?void 0:e.method)==null?void 0:r.toUpperCase())||"GET"};function z(){const{del:e,get:r,set:Z,update:o}=X(),[s,a]=t.useReducer(I,D),f=t.useRef(),K=async({url:l,fetchOptions:L,maxAge:h=E})=>{let u=f.current;a({type:"loading",loading:!0});let W=x(L);W==="DELETE"&&e(l.toString()),W==="GET"&&r(l.toString()).then(c=>{if(!c)throw new Error("no value found in db");w(h,c==null?void 0:c.timestamp)?e(l.toString()):a({type:"pre-load",data:c==null?void 0:c.data})}).catch(c=>{console.error(c)}),u==null||u.addEventListener("message",({data:{type:c,data:p}})=>{if(c==="DELETE")a({type:"loading",loading:!1});else if(c==="GET"){a({type:"data",data:p});let y={timestamp:Date.now(),maxAge:h,data:p};Z(l.toString(),y).then(()=>{console.log("saved data")}).catch(()=>{console.error("couldn't access indexedDB to save data")})}else c==="PUT"||c==="POST"?o(l.toString(),b=>{let y=Date.now(),T=Y(p)&&Y(b==null?void 0:b.data)?i(i({},p),b.data):p;return a({type:"data",data:T}),{timestamp:y,maxAge:h,data:T}}).then(()=>{console.log("updated data")}).catch(()=>{a({type:"loading",loading:!1}),console.error("save to indexedDB failed")}):a({type:"error",error:new Error(c)})}),u==null||u.postMessage({type:"fetch",url:l,fetchOptions:L})};return t.useEffect(()=>(f.current=new B,()=>{J(f.current)}),[]),i({fetchWorker:K},s)}const D={data:void 0,error:void 0,loading:!1,update:!0};n.useFetch=z,n.useStore=X,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
