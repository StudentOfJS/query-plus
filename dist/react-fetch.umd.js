(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("react"),require("idb-keyval")):typeof define=="function"&&define.amd?define(["exports","react","idb-keyval"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n["react-fetch"]={},n.React,n.idbKeyval))})(this,function(n,t,c){"use strict";var k=Object.defineProperty,O=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var H=(n,t,c)=>t in n?k(n,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[t]=c,a=(n,t)=>{for(var c in t||(t={}))j.call(t,c)&&H(n,c,t[c]);if(B)for(var c of B(t))v.call(t,c)&&H(n,c,t[c]);return n},f=(n,t)=>O(n,P(t));const y="dmFyIGQ9T2JqZWN0LmRlZmluZVByb3BlcnR5LGc9T2JqZWN0LmRlZmluZVByb3BlcnRpZXM7dmFyIG09T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7dmFyIGw9T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczt2YXIgdz1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LHk9T2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTt2YXIgYz0ocix0LGUpPT50IGluIHI/ZChyLHQse2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOmV9KTpyW3RdPWUsaD0ocix0KT0+e2Zvcih2YXIgZSBpbiB0fHwodD17fSkpdy5jYWxsKHQsZSkmJmMocixlLHRbZV0pO2lmKGwpZm9yKHZhciBlIG9mIGwodCkpeS5jYWxsKHQsZSkmJmMocixlLHRbZV0pO3JldHVybiByfSxmPShyLHQpPT5nKHIsbSh0KSk7KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IHI9dD0+dCYmdC5tZXRob2Q/dC5tZXRob2QudG9VcHBlckNhc2UoKToiR0VUIjtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLHQ9Pntjb25zdHt0eXBlOmV9PXQuZGF0YTtsZXQgcz1uZXcgQWJvcnRDb250cm9sbGVyLG49cy5zaWduYWw7aWYoZT09PSJjYW5jZWwiJiZzLmFib3J0KCksZT09PSJmZXRjaCIpe2NvbnN0e3VybDppLG9wdGlvbnM6YX09dC5kYXRhO2ZldGNoKGksYT9mKGgoe30sYSkse3NpZ25hbDpufSk6e3NpZ25hbDpufSkudGhlbihvPT57aWYoIW8ub2t8fG8uc3RhdHVzPT09NDA0KXRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgU3RhdHVzOiAke28uc3RhdHVzfWApO2lmKG8uc3RhdHVzPT09NDAzKXRocm93IG5ldyBFcnJvcigiVW5hdXRob3JpemVkISIpO3JldHVybiBvLmpzb24oKX0pLnRoZW4obz0+e2xldCB1PXIoYSk7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTp1LGRhdGE6b30pLHM9dm9pZCAwfSkuY2F0Y2gobz0+e3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6by5tZXNzYWdlfHwiVW5rbm93biBlcnJvciJ9KX0pfX0pfSkoKTsK",G=typeof window!="undefined"&&window.Blob&&new Blob([atob(y)],{type:"text/javascript;charset=utf-8"});function Y(){const e=G&&(window.URL||window.webkitURL).createObjectURL(G);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+y,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}const w="usestore-db",J="usestore-db",W=e=>{const{persistData:o,storeName:b}=a({persistData:!0,storeName:J},e),s=t.useRef();return t.useEffect(()=>(s.current=c.createStore(w,b),()=>{!o&&c.clear(s.current),s.current=void 0}),[]),{del:r=>c.del(r,s.current),get:r=>c.get(r,s.current),getMany:r=>c.getMany(r,s.current),set:(r,i)=>c.set(r,i,s.current),setMany:r=>c.setMany(r,s.current),update:(r,i)=>c.update(r,i,s.current)}};function I(e,o){switch(o.type){case"pre-load":return f(a({},e),{data:o.data});case"data":return f(a({},e),{data:o.data,loading:!1,error:void 0});case"error":return f(a({},e),{error:o.error,loading:!1});case"loading":return f(a({},e),{loading:o.loading});default:return e}}const X=24*60*60*1e3,g=e=>typeof e=="object"&&!Array.isArray(e)&&e!==null;function E(e){e==null||e.postMessage({type:"cancel"}),e==null||e.terminate(),e=void 0}const z=(e,o=0)=>o+e>Date.now(),N=e=>{var o;return((o=e==null?void 0:e.method)==null?void 0:o.toUpperCase())||"GET"};function V(){const{del:e,get:o,set:b,update:s}=W(),[r,i]=t.useReducer(I,D),Z=t.useRef(),U=async({url:l,fetchOptions:S,maxAge:h=X})=>{let u=Z.current;i({type:"loading",loading:!0});let T=N(S);T==="DELETE"&&e(l.toString()),T==="GET"&&o(l.toString()).then(d=>{if(!d)throw new Error("no value found in db");z(h,d==null?void 0:d.timestamp)?e(l.toString()):i({type:"pre-load",data:d==null?void 0:d.data})}).catch(d=>{console.error(d)}),u==null||u.addEventListener("message",({data:{type:d,data:p}})=>{if(d==="DELETE")i({type:"loading",loading:!1});else if(d==="GET"){i({type:"data",data:p});let R={timestamp:Date.now(),maxAge:h,data:p};b(l.toString(),R).then(()=>{console.log("saved data")}).catch(()=>{console.error("couldn't access indexedDB to save data")})}else d==="PUT"||d==="POST"?s(l.toString(),m=>{let R=Date.now(),L=g(p)&&g(m==null?void 0:m.data)?a(a({},p),m.data):p;return i({type:"data",data:L}),{timestamp:R,maxAge:h,data:L}}).then(()=>{console.log("updated data")}).catch(()=>{i({type:"loading",loading:!1}),console.error("save to indexedDB failed")}):i({type:"error",error:new Error(d)})}),u==null||u.postMessage({type:"fetch",url:l,fetchOptions:S})};return t.useEffect(()=>(Z.current=new Y,()=>{E(Z.current)}),[]),a({fetchWorker:U},r)}const D={data:void 0,error:void 0,loading:!1,update:!0};n.useFetch=V,n.useStore=W,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
