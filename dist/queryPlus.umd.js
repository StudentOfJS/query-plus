(function(l,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("react"),require("idb-keyval")):typeof define=="function"&&define.amd?define(["exports","react","idb-keyval"],e):(l=typeof globalThis!="undefined"?globalThis:l||self,e(l.queryPlus={},l.React))})(this,function(l,e){"use strict";var C=Object.defineProperty,I=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var R=(l,e,b)=>e in l?C(l,e,{enumerable:!0,configurable:!0,writable:!0,value:b}):l[e]=b,Z=(l,e)=>{for(var b in e||(e={}))L.call(e,b)&&R(l,b,e[b]);if(Y)for(var b of Y(e))r.call(e,b)&&R(l,b,e[b]);return l},n=(l,e)=>I(l,P(e));const b="dmFyIEk9T2JqZWN0LmRlZmluZVByb3BlcnR5LFE9T2JqZWN0LmRlZmluZVByb3BlcnRpZXM7dmFyIFc9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7dmFyIFU9T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczt2YXIgWD1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LFk9T2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZTt2YXIgXz0oaSxmLGQpPT5mIGluIGk/SShpLGYse2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOmR9KTppW2ZdPWQsbD0oaSxmKT0+e2Zvcih2YXIgZCBpbiBmfHwoZj17fSkpWC5jYWxsKGYsZCkmJl8oaSxkLGZbZF0pO2lmKFUpZm9yKHZhciBkIG9mIFUoZikpWS5jYWxsKGYsZCkmJl8oaSxkLGZbZF0pO3JldHVybiBpfSxDPShpLGYpPT5RKGksVyhmKSk7KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGkodCl7cmV0dXJuIG5ldyBQcm9taXNlKChlLG4pPT57dC5vbmNvbXBsZXRlPXQub25zdWNjZXNzPSgpPT5lKHQucmVzdWx0KSx0Lm9uYWJvcnQ9dC5vbmVycm9yPSgpPT5uKHQuZXJyb3IpfSl9ZnVuY3Rpb24gZih0LGUpe2NvbnN0IG49aW5kZXhlZERCLm9wZW4odCk7bi5vbnVwZ3JhZGVuZWVkZWQ9KCk9Pm4ucmVzdWx0LmNyZWF0ZU9iamVjdFN0b3JlKGUpO2NvbnN0IHI9aShuKTtyZXR1cm4ocyxoKT0+ci50aGVuKGE9PmgoYS50cmFuc2FjdGlvbihlLHMpLm9iamVjdFN0b3JlKGUpKSl9bGV0IGQ7ZnVuY3Rpb24gQSgpe3JldHVybiBkfHwoZD1mKCJrZXl2YWwtc3RvcmUiLCJrZXl2YWwiKSksZH1mdW5jdGlvbiBHKHQsZT1BKCkpe3JldHVybiBlKCJyZWFkb25seSIsbj0+aShuLmdldCh0KSkpfWZ1bmN0aW9uICQodCxlLG49QSgpKXtyZXR1cm4gbigicmVhZHdyaXRlIixyPT4oci5wdXQoZSx0KSxpKHIudHJhbnNhY3Rpb24pKSl9ZnVuY3Rpb24gRih0LGUsbj1BKCkpe3JldHVybiBuKCJyZWFkd3JpdGUiLHI9Pm5ldyBQcm9taXNlKChzLGgpPT57ci5nZXQodCkub25zdWNjZXNzPWZ1bmN0aW9uKCl7dHJ5e3IucHV0KGUodGhpcy5yZXN1bHQpLHQpLHMoaShyLnRyYW5zYWN0aW9uKSl9Y2F0Y2goYSl7aChhKX19fSkpfWZ1bmN0aW9uIGoodCxlPUEoKSl7cmV0dXJuIGUoInJlYWR3cml0ZSIsbj0+KG4uZGVsZXRlKHQpLGkobi50cmFuc2FjdGlvbikpKX1mdW5jdGlvbiB6KCl7Y29uc3Qgbj1mKCJ1c2VzdG9yZS1kYiIsInVzZXN0b3JlLWRiIik7cmV0dXJue3JlbW92ZTpjPT5qKGMsbiksZ2V0RGF0YTpjPT5HKGMsbiksc2V0RGF0YTooYyxnKT0+JChjLGcsbiksdXBkYXRlRGF0YTooYyxnKT0+RihjLGcsbil9fWNvbnN0IEg9KHQsZSk9PmU/dCtlPERhdGUubm93KCk6ITAsbT10PT50eXBlb2YgdD09Im9iamVjdCImJiFBcnJheS5pc0FycmF5KHQpJiZ0IT09bnVsbCxTPSh0LGUsbj17fSk9PihPYmplY3Qua2V5cyh0KS5mb3JFYWNoKHI9PntsZXQgcz1lP2UrIi4iK3I6cjttKHRbcl0pP1ModFtyXSxzLG4pOm5bc109QXJyYXkuaXNBcnJheSh0W3JdKT90W3JdLnNvcnQoKTp0W3JdfSksT2JqZWN0LmVudHJpZXMobikuc29ydCgpKSxQPXQ9PnQuZmxhdE1hcChlPT5tKGUpP1MoZSk6W2VdKS5zb3J0KCksSj10PT57dmFyIGUsbjtyZXR1cm4obj0oZT10PT1udWxsP3ZvaWQgMDp0Lm1ldGhvZCk9PW51bGw/dm9pZCAwOmUudG9VcHBlckNhc2UoKSkhPW51bGw/bjoiR0VUIn0sQj0odCxlLG4pPT57bGV0IHI9QXJyYXkuaXNBcnJheSh0KT8iYXJyYXkiOnR5cGVvZiB0LHM9QXJyYXkuaXNBcnJheShlKT8iYXJyYXkiOnR5cGVvZiBlO3JldHVybiByIT09cz8hMTpyIT09Im9iamVjdCImJnIhPT0iYXJyYXkiP3I9PT1zOm4mJnI9PT0ib2JqZWN0Ij9uLm1hcChoPT50W2hdPT09ZVtoXSkuZXZlcnkoaD0+aCk6KHI9PT0iYXJyYXkiJiYodD1QKHQpLGU9UChlKSksIW4mJnI9PT0ib2JqZWN0IiYmKHQ9Uyh0KSxlPVMoZSkpLEpTT04uc3RyaW5naWZ5KHQpPT09SlNPTi5zdHJpbmdpZnkoZSkpfSx4PXQ9PnQ/bmV3IEZ1bmN0aW9uKGByZXR1cm4gJHtkZWNvZGVVUkkodCl9YCkoKTplPT5lLHtyZW1vdmU6TCxnZXREYXRhOk4sc2V0RGF0YTpSLHVwZGF0ZURhdGE6Yn09eigpLHk9dD0+e2lmKCF0Lm9rfHx0LnN0YXR1cz09PTQwNCl0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3IhIFN0YXR1czogJHt0LnN0YXR1c31gKTtpZih0LnN0YXR1cz09PTQwMyl0aHJvdyBuZXcgRXJyb3IoIlVuYXV0aG9yaXplZCEiKTtyZXR1cm4gdC5qc29uKCl9LE09dD0+e3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6dC5tZXNzYWdlfHwiVW5rbm93biBlcnJvciJ9KX07c2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIix0PT57Y29uc3R7dHlwZTplfT10LmRhdGE7bGV0IG49bmV3IEFib3J0Q29udHJvbGxlcixyPW49PW51bGw/dm9pZCAwOm4uc2lnbmFsO2lmKGU9PT0iY2FuY2VsIiYmKG49PW51bGx8fG4uYWJvcnQoKSksZT09PSJwcmUtZmV0Y2giKXtsZXR7cHJlZmV0Y2g6c309dC5kYXRhO3MuZm9yRWFjaCgoe21pZGRsZXdhcmU6aCx1cmw6YSxvcHRpb25zOmMsbWF4QWdlOmd9KT0+e2xldCBPPXgoaCk7ZmV0Y2goYS50b1N0cmluZygpLGwoe3NpZ25hbDpyfSxjKSkudGhlbih5KS50aGVuKHU9PntSKGEudG9TdHJpbmcoKSx7dGltZXN0YW1wOkRhdGUubm93KCksZGF0YTpPKHUpLG1heEFnZTpnfSkudGhlbigoKT0+e2NvbnNvbGUubG9nKGBzYXZlZCBwcmVmZXRjaCAke2F9YCl9KS5jYXRjaChEPT57Y29uc29sZS5sb2coYGVycm9yIHNhdmluZyBwcmVmZXRjaCAke2F9YCxEKX0pfSkuY2F0Y2goKCk9Pntjb25zb2xlLmluZm8oIm5vIGRhdGEgZm91bmQiKX0pfSl9aWYoZT09PSJmZXRjaCIpe2xldHtleGlzdGluZ0RhdGE6cyxwcmVmZXJVc2VDYWNoZTpoLHVybDphLG9wdGlvbnM6YyxtYXhBZ2U6ZyxtaWRkbGV3YXJlOk8sdXBkYXRlOnV9PXQuZGF0YTtjb25zdCBEPXA9PntwPXgoTykocCksKCFzfHwhQihzLHApKSYmKHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkRBVEEiLGRhdGE6cH0pLFIoYS50b1N0cmluZygpLHtkYXRhOnAsdGltZXN0YW1wOkRhdGUubm93KCksbWF4QWdlOmd9KS50aGVuKCgpPT57Y29uc29sZS5pbmZvKCJzYXZlZCBkYXRhIil9KS5jYXRjaCgoKT0+e2NvbnNvbGUuaW5mbygiY291bGRuJ3QgYWNjZXNzIGluZGV4ZWREQiB0byBzYXZlIGRhdGEiKX0pKSxzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOiJDT01QTEVURSJ9KX07bGV0IEU9SihjKTtpZihFPT09IkRFTEVURSImJihMKGEudG9TdHJpbmcoKSksZmV0Y2goYSxjKS50aGVuKCgpPT57dT9mZXRjaCh1LnVybCx1Lm9wdGlvbnMpLnRoZW4oeSkudGhlbihEKS5jYXRjaChwPT57dGhyb3cgcH0pOnNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkNPTVBMRVRFIn0pfSkuY2F0Y2goTSkpLEU9PT0iR0VUIil7bGV0IHA9ITE7TihhLnRvU3RyaW5nKCkpLnRoZW4obz0+e2lmKCFvKXRocm93IG5ldyBFcnJvcigibm8gdmFsdWUgZm91bmQgaW4gZGIiKTtpZihIKG89PW51bGw/dm9pZCAwOm8ubWF4QWdlLG89PW51bGw/dm9pZCAwOm8udGltZXN0YW1wKSl0aHJvdyBMKGEudG9TdHJpbmcoKSksbmV3IEVycm9yKCJkYXRhIGV4cGlyZWQiKTtsZXQgdz1CKG89PW51bGw/dm9pZCAwOm8uZGF0YSxzKTtoJiYocD0hMCk7bGV0IFQ9e3R5cGU6aD8iREFUQSI6dz8iQ0FDSEVEIjoiUFJFX0xPQUQiLGRhdGE6IWgmJnd8fG89PW51bGw/dm9pZCAwOm8uZGF0YX07c2VsZi5wb3N0TWVzc2FnZShUKX0pLmNhdGNoKG89Pntjb25zb2xlLmluZm8obz09bnVsbD92b2lkIDA6by5tZXNzYWdlKX0pLCFwJiZmZXRjaChhLGM/QyhsKHt9LGMpLHtzaWduYWw6cn0pOntzaWduYWw6cn0pLnRoZW4oeSkudGhlbihEKS5jYXRjaChNKX0oRT09PSJQVVQifHxFPT09IlBPU1QiKSYmZmV0Y2goYSxjP0MobCh7fSxjKSx7c2lnbmFsOnJ9KTp7c2lnbmFsOnJ9KS50aGVuKHkpLnRoZW4ocD0+e3U/ZmV0Y2godS51cmwsdS5vcHRpb25zKS50aGVuKHkpLnRoZW4oRCkuY2F0Y2gobz0+e3Rocm93IG99KTpiKGEudG9TdHJpbmcoKSxvPT57bGV0IHc9RGF0ZS5ub3coKSxUPW0ocCkmJm0obz09bnVsbD92b2lkIDA6by5kYXRhKT9sKGwoe30sby5kYXRhKSxwKTpwO3JldHVybiBzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOkUsZGF0YTpUfSkse3RpbWVzdGFtcDp3LG1heEFnZTpnLGRhdGE6VH19KS5jYXRjaCgoKT0+e2NvbnNvbGUuaW5mbygidXBkYXRlIHN0b3JlIGZhaWxlZCIpfSkuZmluYWxseSgoKT0+e3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkNPTVBMRVRFIn0pfSl9KS5jYXRjaChNKX19KX0pKCk7Cg==",u=typeof window!="undefined"&&window.Blob&&new Blob([atob(b)],{type:"text/javascript;charset=utf-8"});function o(){const d=u&&(window.URL||window.webkitURL).createObjectURL(u);try{return d?new Worker(d,{}):new Worker("data:application/javascript;base64,"+b,{type:"module"})}finally{d&&(window.URL||window.webkitURL).revokeObjectURL(d)}}const X={data:void 0,error:void 0,loading:!1,preload:!1,update:!0};function s(d,c){switch(c.type){case"pre-load":return n(Z({},d),{data:c.data,loading:!1,preload:!0,error:void 0});case"data":return n(Z({},d),{data:c.data,loading:!1,preload:!1,error:void 0});case"error":return n(Z({},d),{error:c.error,loading:!1,preload:!1});case"loading":return n(Z({},d),{loading:c.loading});default:return d}}const h=24*60*60*1e3;function p(d){d==null||d.postMessage({type:"cancel"}),d==null||d.terminate(),d=void 0}const K=d=>d?encodeURI(d.toString()):void 0;function W(){const[d,c]=e.useReducer(s,X),m=e.useRef(),G=async({url:T,options:y,maxAge:k=h,preferUseCache:V,middleware:J})=>{let i=m.current;c({type:"loading",loading:!0}),i==null||i.addEventListener("message",({data:{type:a,data:t}})=>{switch(a){case"CACHED":case"COMPLETE":c({type:"loading",loading:!1});break;case"DATA":c({type:"data",data:t});break;case"PRE_LOAD":c({type:"pre-load",data:t});break;default:c({type:"error",error:new Error(a)});break}}),i==null||i.postMessage({type:"fetch",url:T,options:y,existingData:d.data,middleware:K(J),maxAge:k,preferUseCache:V})};return e.useEffect(()=>(m.current=new o,()=>{p(m.current)}),[]),Z({fetchWorker:G},d)}function S(d){const c=e.useRef(new o);e.useEffect(()=>{var m;d&&c.current&&((m=c.current)==null||m.postMessage({type:"pre-fetch",prefetch:d.map(G=>n(Z({},G),{middleware:K(G.middleware)}))}))},[d,c.current]),e.useEffect(()=>(c.current=new o,()=>{p(c.current)}),[])}l.useFetch=W,l.usePreFetch=S,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
